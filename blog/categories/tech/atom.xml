<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Tech | tac42.net]]></title>
  <link href="https://www.tac42.net/blog/categories/tech/atom.xml" rel="self"/>
  <link href="https://www.tac42.net/"/>
  <updated>2016-03-29T00:53:08+09:00</updated>
  <id>https://www.tac42.net/</id>
  <author>
    <name><![CDATA[TAC]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RaspberryPi2をセットアップする]]></title>
    <link href="https://www.tac42.net/blog/tech/2016/01/05/raspberrypi-setup/"/>
    <updated>2016-01-05T01:42:19+09:00</updated>
    <id>https://www.tac42.net/blog/tech/2016/01/05/raspberrypi-setup</id>
    <content type="html"><![CDATA[<p><img src="/assets/blog/2016-01-05-raspberrypi-setup/raspi.jpg" alt="RaspberryPi" /></p>

<p>すごい今更感ありますが、Raspberry Pi2 Model B を買ってしまったのでセットアップしたメモ．
sshするところまで．</p>

<h1>イメージの書き込み</h1>

<p>OSイメージをmicroSDへ書き込む．使用OSごとの書き込み方法は<a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md">こちら</a>を参照．</p>

<p>イメージをダウンロード．今回使用したのは RASPBIAN JESSIE で、1.3GBくらい．なかなか落ちてこない．
<a href="https://www.raspberrypi.org/downloads/raspbian/">Download Raspbian for RaspberryPi</a></p>

<pre><code class="sh">$ unzip 2015-11-21-raspbian-jessie.zip
</code></pre>

<p>書き込みたいディスクを確認．別なディスクに書き込むと大変なことになるので慎重に．
<code>sh
$ diskutil list
/dev/disk0 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *121.3 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:          Apple_CoreStorage Macintosh HD            121.0 GB   disk0s2
   3:                 Apple_Boot Boot OS X               134.2 MB   disk0s3
/dev/disk1 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *1.0 TB     disk1
   1:                        EFI EFI                     209.7 MB   disk1s1
   2:          Apple_CoreStorage Macintosh HD            999.3 GB   disk1s2
   3:                 Apple_Boot Recovery HD             650.1 MB   disk1s3
/dev/disk2 (internal, virtual):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:                  Apple_HFS Macintosh HD           +1.1 TB     disk2
                                 Logical Volume on disk0s2, disk1s2
                                 D17EF55D-4792-45E2-A2A1-BA52348E9108
                                 Unencrypted Fusion Drive
/dev/disk5 (external, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:     FDisk_partition_scheme                        *31.9 GB    disk5
   1:             Windows_FAT_32 NO NAME                 31.9 GB    disk5s1
</code></p>

<p>/dev/disk5 っぽい．<code>dd</code>で書き込む．めっちゃ時間かかる．
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>diskutil unmountDisk /dev/disk5
</span><span class='line'>Unmount of all volumes on disk5 was successful&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>sudo dd <span class="nv">bs</span><span class="o">=</span>1m <span class="k">if</span><span class="o">=</span>2015-11-21-raspbian-jessie.img  <span class="nv">of</span><span class="o">=</span>/dev/disk5
</span><span class='line'>3752+0 records in
</span><span class='line'>3752+0 records out
</span><span class='line'><span class="m">3934257152</span> bytes transferred in 1713.306842 secs <span class="o">(</span><span class="m">2296295</span> bytes/sec<span class="o">)</span>
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>
30分近くかかってたらしい．</p>

<p>書き込み終わったmicroSDをRaspberryPi2に差し込んで起動する．</p>

<h1>シリアル接続</h1>

<h2>シリアルドライバのインストール</h2>

<p><a href="http://www.prolific.com.tw/US/ShowProduct.aspx?p_id=229&amp;pcid=41">ここ</a>からドライバをダウンロード．</p>

<pre><code class="sh">$ unzip PL2303_MacOSX_1_6_0_20151022.zip
</code></pre>

<p>出てきたpkgファイルをダブルクリックして実行．PCを再起動する．</p>

<h2>接続</h2>

<p>ボーレートは115200．</p>

<pre><code class="sh">$ sudo cu -s 115200 -l /dev/tty.usbserial
Connected.

Raspbian GNU/Linux 8 raspberrypi ttyAMA0

raspberrypi login:
</code></pre>

<p>ユーザ名は &ldquo;pi&rdquo;, パスワードは &ldquo;raspberry&rdquo; でログイン．</p>

<pre><code>Last login: Sat Nov 21 21:35:31 UTC 2015 on tty1
Linux raspberrypi 4.1.13-v7+ #826 SMP PREEMPT Fri Nov 13 20:19:03 GMT 2015 armv7l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
pi@raspberrypi:~$
</code></pre>

<p>ログインできた．最初からRubyとかgitとか入っててすごい．．．</p>

<h2>初期設定</h2>

<p>ファイルシステム拡張とSSHを有効にする．</p>

<pre><code class="text">pi@raspberrypi:~$ sudo raspi-config
┌─────────┤ Raspberry Pi Software Configuration Tool (raspi-config) ├──────────┐
│                                                                              │
│    1 Expand Filesystem              Ensures that all of the SD card s        │
│    2 Change User Password           Change password for the default u        │
│    3 Boot Options                   Choose whether to boot into a des        │
│    4 Wait for Network at Boot       Choose whether to wait for networ        │
│    5 Internationalisation Options   Set up language and regional sett        │
│    6 Enable Camera                  Enable this Pi to work with the R        │
│    7 Add to Rastrack                Add this Pi to the online Raspber        │
│    8 Overclock                      Configure overclocking for your P        │
│    9 Advanced Options               Configure advanced settings              │
│    0 About raspi-config             Information about this configurat        │
│                                                                              │
│                                                                              │
│                     &lt;Select&gt;                     &lt;Finish&gt;                    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
</code></pre>

<p><code>Expand Filesystem</code>, と <code>Advanced Options -&gt; SSH -&gt; Enable</code> で．Finish して Reboot.</p>

<h1>ネットワーク設定</h1>

<p>無線LAN接続じゃないとやってられんので、<a href="http://www.amazon.co.jp/gp/product/B00JTSF8WO/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00JTSF8WO&amp;linkCode=as2&amp;tag=tac42-22">ELECOMのWDC-150SU2MWH</a> をつないでみた．
<a href="http://www.amazon.co.jp/gp/product/B010EGTPVY/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B010EGTPVY&amp;linkCode=as2&amp;tag=tac42-22">BuffaloのWLI-UC-GNME</a> も試したが、後述のプチ切れ対策を行っても、しばらくすると通信できなくなってしまった．</p>

<h2>ドングルの設定</h2>

<pre><code>pi@raspberrypi:~$ lsusb
Bus 001 Device 004: ID 0411:01a2 BUFFALO INC. (formerly MelCo., Inc.) WLI-UC-GNM Wireless LAN Adapter [Ralink RT8070]
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter
Bus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre>

<p><code>ID 0411:01a2</code> として認識出来てるっぽい． 設定は<a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">こちら</a>を参照．
以下でAP一覧を確認できる．
<code>
pi@raspberrypi:~$ sudo iwlist wlan0 scan | less
</code></p>

<p><code>/etc/wpa_supplicant/wpa_supplicant.conf</code> を修正し、APの設定を追加する．
<code>sh
pi@raspberrypi:~$ sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
</code>
<code>diff
--- wpa_supplicant.conf.org 2015-11-21 22:17:56.359999815 +0000
+++ /etc/wpa_supplicant/wpa_supplicant.conf     2015-11-21 22:19:14.759999785 +0000
@@ -1,2 +1,6 @@
 ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
 update_config=1
+network={
+    ssid="The_ESSID_from_earlier"
+    psk="Your_wifi_password"
+}
</code></p>

<p>ifの再起動
<code>sh
pi@raspberrypi:~$ sudo ifdown wlan0 &amp;&amp; sudo ifup wlan0
</code></p>

<p>確認
<code>sh
pi@raspberrypi:~$ ifconfig wlan0
wlan0     Link encap:Ethernet  HWaddr cc:e1:d5:3e:2a:97
          inet addr:192.168.11.110  Bcast:192.168.11.255  Mask:255.255.255.0
          inet6 addr: fe80::fe15:1190:9afa:732b/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:18 errors:0 dropped:0 overruns:0 frame:0
          TX packets:30 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:2944 (2.8 KiB)  TX bytes:5250 (5.1 KiB)
</code>
つながったっぽい．</p>

<pre><code>$ ping 192.168.11.110
ING 192.168.11.110 (192.168.11.110): 56 data bytes
64 bytes from 192.168.11.110: icmp_seq=0 ttl=64 time=1.043 ms
64 bytes from 192.168.11.110: icmp_seq=1 ttl=64 time=1.289 ms
...
</code></pre>

<p>きたきた．</p>

<pre><code>$ ssh 192.168.11.110
The authenticity of host '192.168.11.110 (192.168.11.110)' can't be established.
ECDSA key fingerprint is SHA256:...
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.11.110' (ECDSA) to the list of known hosts.

pi@raspberrypi:~$
</code></pre>

<p>きたー！！</p>

<p>しばらくほっとくと勝手に切れちゃうので、省電力機能を無効化する．
<code>
pi@raspberrypi:~$ sudo nano /etc/modprobe.d/8192cu.conf
</code></p>

<pre><code class="diff">+ options 8192cu rtw_power_mgnt=0 rtw_enusbss=1 rtw_ips_mode=1
</code></pre>

<h2>電力アップ</h2>

<pre><code class="sh">$ sudo nano /boot/config.txt
</code></pre>

<pre><code class="diff">+ safe_mode_apio=4
+ max_usb_current=1
</code></pre>

<pre><code>pi@raspberrypi:~$ sudo reboot
</code></pre>

<h1>参考</h1>

<p><a href="http://sig9.hatenablog.com/entry/2015/08/22/233646">http://sig9.hatenablog.com/entry/2015/08/22/233646</a>
<a href="http://denshikousaku.net/fix-sluggish-response-of-raspberry-pi-wifi-adaptor">http://denshikousaku.net/fix-sluggish-response-of-raspberry-pi-wifi-adaptor</a></p>
]]></content>
  </entry>
  
</feed>
